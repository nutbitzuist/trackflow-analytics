<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrackFlow Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <style>
        * {
            font-family: 'DM Sans', sans-serif;
        }

        .font-mono {
            font-family: 'Space Mono', monospace;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
            }

            50% {
                box-shadow: 0 0 20px 5px rgba(99, 102, 241, 0.2);
            }
        }

        @keyframes gradient-shift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .animate-slide-up {
            animation: slideUp 0.5s ease-out forwards;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .animate-pulse-glow {
            animation: pulse-glow 2s infinite;
        }

        .gradient-animated {
            background: linear-gradient(-45deg, #667eea, #764ba2, #6B8DD6, #8E37D7);
            background-size: 400% 400%;
            animation: gradient-shift 15s ease infinite;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .dark .glass-card {
            background: rgba(30, 30, 40, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.15);
        }

        .sidebar-item {
            transition: all 0.2s ease;
        }

        .sidebar-item:hover {
            transform: translateX(4px);
        }

        .live-dot {
            animation: pulse-glow 1.5s infinite;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.5);
        }

        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.015;
            z-index: 1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 dark:bg-slate-900 min-h-screen">
    <div class="noise-overlay"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // Configuration
        const API_BASE = 'https://trackflow-backend-production.up.railway.app';

        // Icons
        const Icons = {
            Dashboard: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
            ),
            Globe: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            ),
            Users: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
            ),
            Chart: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
            ),
            Code: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                </svg>
            ),
            Settings: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            ),
            Plus: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                </svg>
            ),
            Eye: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
            ),
            Clock: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            ),
            TrendUp: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
            ),
            TrendDown: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
                </svg>
            ),
            Copy: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
            ),
            Check: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                </svg>
            ),
            Live: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M13 12a1 1 0 11-2 0 1 1 0 012 0z" />
                </svg>
            ),
            Funnel: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                </svg>
            ),
            Moon: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            ),
            Sun: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
            ),
            ChevronDown: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                </svg>
            ),
            ArrowRight: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
            ),
            Dollar: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            ),
        };

        // Chart Component
        const AnalyticsChart = ({ data, selectedMetric }) => {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);

            useEffect(() => {
                if (!data || data.length === 0) return;

                if (chartRef.current) {
                    chartRef.current.destroy();
                }

                const ctx = canvasRef.current.getContext('2d');

                const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                gradient.addColorStop(0, 'rgba(99, 102, 241, 0.3)');
                gradient.addColorStop(1, 'rgba(99, 102, 241, 0)');

                chartRef.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => {
                            const date = new Date(d.date);
                            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        }),
                        datasets: [{
                            label: selectedMetric,
                            data: data.map(d => d[selectedMetric]),
                            borderColor: '#6366f1',
                            backgroundColor: gradient,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 6,
                            pointHoverBackgroundColor: '#6366f1',
                            pointHoverBorderColor: '#fff',
                            pointHoverBorderWidth: 3,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        },
                        plugins: {
                            legend: {
                                display: false,
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                padding: 16,
                                cornerRadius: 12,
                                titleFont: {
                                    size: 14,
                                    weight: '600',
                                    family: 'DM Sans',
                                },
                                bodyFont: {
                                    size: 24,
                                    weight: '700',
                                    family: 'DM Sans',
                                },
                                displayColors: false,
                                callbacks: {
                                    label: (context) => context.parsed.y.toLocaleString(),
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false,
                                },
                                ticks: {
                                    color: '#94a3b8',
                                    font: {
                                        size: 11,
                                        family: 'DM Sans',
                                    },
                                    maxTicksLimit: 8,
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(148, 163, 184, 0.1)',
                                },
                                ticks: {
                                    color: '#94a3b8',
                                    font: {
                                        size: 11,
                                        family: 'DM Sans',
                                    },
                                    callback: (value) => value >= 1000 ? `${value / 1000}k` : value,
                                },
                                border: {
                                    display: false,
                                }
                            }
                        }
                    }
                });

                return () => {
                    if (chartRef.current) {
                        chartRef.current.destroy();
                    }
                };
            }, [data, selectedMetric]);

            return <canvas ref={canvasRef} />;
        };

        // Stat Card Component
        const StatCard = ({ title, value, change, icon, delay = 0 }) => {
            const isPositive = change >= 0;
            return (
                <div
                    className="stat-card glass-card rounded-2xl p-6 animate-slide-up"
                    style={{ animationDelay: `${delay}ms` }}
                >
                    <div className="flex items-center justify-between mb-4">
                        <span className="text-slate-500 dark:text-slate-400 text-sm font-medium">{title}</span>
                        <div className="w-10 h-10 rounded-xl bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center text-primary-600 dark:text-primary-400">
                            {icon}
                        </div>
                    </div>
                    <div className="flex items-end gap-3">
                        <span className="text-3xl font-bold text-slate-900 dark:text-white">{value}</span>
                        <span className={`flex items-center gap-1 text-sm font-medium ${isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                            {isPositive ? <Icons.TrendUp /> : <Icons.TrendDown />}
                            {Math.abs(change)}%
                        </span>
                    </div>
                </div>
            );
        };

        // Progress Bar Component
        const ProgressBar = ({ percentage, color = '#6366f1', delay = 0 }) => (
            <div className="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                <div
                    className="h-full rounded-full transition-all duration-1000 ease-out"
                    style={{
                        width: `${percentage}%`,
                        backgroundColor: color,
                        animationDelay: `${delay}ms`
                    }}
                />
            </div>
        );

        // Website Selector Component
        const WebsiteSelector = ({ websites, selectedSite, onSelect }) => {
            const [isOpen, setIsOpen] = useState(false);
            const selected = websites.find(w => w.id === selectedSite);

            return (
                <div className="relative">
                    <button
                        onClick={() => setIsOpen(!isOpen)}
                        className="flex items-center gap-3 px-4 py-3 glass-card rounded-xl hover:bg-white/80 dark:hover:bg-slate-800/80 transition-colors w-full"
                    >
                        <div className="w-8 h-8 rounded-lg flex items-center justify-center" style={{ backgroundColor: selected?.color + '20' }}>
                            <Icons.Globe />
                        </div>
                        <div className="flex-1 text-left">
                            <div className="font-semibold text-slate-900 dark:text-white text-sm">{selected?.name || 'Create Website'}</div>
                            {selected && <div className="text-xs text-slate-500">{selected.domain}</div>}
                        </div>
                        <Icons.ChevronDown />
                    </button>

                    {isOpen && (
                        <div className="absolute top-full left-0 right-0 mt-2 glass-card rounded-xl shadow-2xl z-50 max-h-80 overflow-auto animate-fade-in">
                            {websites.map((site) => (
                                <button
                                    key={site.id}
                                    onClick={() => {
                                        onSelect(site.id);
                                        setIsOpen(false);
                                    }}
                                    className={`flex items-center gap-3 px-4 py-3 hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-colors w-full ${site.id === selectedSite ? 'bg-primary-50 dark:bg-primary-900/20' : ''
                                        }`}
                                >
                                    <div className="w-8 h-8 rounded-lg flex items-center justify-center" style={{ backgroundColor: site.color + '20' }}>
                                        <div className="w-3 h-3 rounded-full" style={{ backgroundColor: site.color }} />
                                    </div>
                                    <div className="flex-1 text-left">
                                        <div className="font-medium text-slate-900 dark:text-white text-sm">{site.domain}</div>
                                    </div>
                                </button>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // Script Modal Component
        const ScriptModal = ({ isOpen, onClose, siteId }) => {
            const [copied, setCopied] = useState(false);

            const script = `<!-- TrackFlow Analytics -->
<script>
  (function(w,d,s,l,i){
    w[l]=w[l]||[];
    var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s);
    j.async=true;
    j.src='https://trackflow-backend-production.up.railway.app/t.js';
    j.setAttribute('data-site','${siteId}');
    f.parentNode.insertBefore(j,f);
  })(window,document,'script','tf','TF-${siteId}');
<\/script>`;

            const handleCopy = () => {
                navigator.clipboard.writeText(script);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in">
                    <div className="glass-card rounded-2xl p-8 max-w-2xl w-full animate-slide-up shadow-2xl">
                        <h3 className="text-2xl font-bold text-slate-900 dark:text-white mb-2">Install Tracking Script</h3>
                        <p className="text-slate-600 dark:text-slate-400 mb-6">
                            Add this script to your website's <code className="px-2 py-1 bg-slate-100 dark:bg-slate-800 rounded text-sm font-mono">&lt;head&gt;</code> tag to start tracking.
                        </p>

                        <div className="relative">
                            <pre className="bg-slate-900 text-slate-100 p-6 rounded-xl text-sm overflow-x-auto font-mono">
                                {script}
                            </pre>
                            <button
                                onClick={handleCopy}
                                className={`absolute top-4 right-4 px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2 transition-all ${copied
                                    ? 'bg-emerald-500 text-white'
                                    : 'bg-white/10 text-white hover:bg-white/20'
                                    }`}
                            >
                                {copied ? <Icons.Check /> : <Icons.Copy />}
                                {copied ? 'Copied!' : 'Copy'}
                            </button>
                        </div>

                        <div className="mt-6 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl border border-amber-200 dark:border-amber-800">
                            <p className="text-amber-800 dark:text-amber-200 text-sm">
                                <strong>Note:</strong> The script is only 4KB and loads asynchronously, so it won't affect your page speed.
                            </p>
                        </div>

                        <div className="flex justify-end mt-6">
                            <button
                                onClick={onClose}
                                className="px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700 transition-colors"
                            >
                                Done
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Add Website Modal
        const AddWebsiteModal = ({ isOpen, onClose, onAdd }) => {
            const [domain, setDomain] = useState('');
            const [name, setName] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in">
                    <div className="glass-card rounded-2xl p-8 max-w-md w-full animate-slide-up shadow-2xl">
                        <h3 className="text-2xl font-bold text-slate-900 dark:text-white mb-2">Add New Website</h3>
                        <p className="text-slate-600 dark:text-slate-400 mb-6">
                            Enter your website domain to start tracking analytics.
                        </p>

                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Site Name</label>
                                <input
                                    type="text"
                                    value={name}
                                    onChange={(e) => setName(e.target.value)}
                                    placeholder="My Cool Store"
                                    className="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Domain</label>
                                <input
                                    type="text"
                                    value={domain}
                                    onChange={(e) => setDomain(e.target.value)}
                                    placeholder="example.com"
                                    className="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all"
                                />
                            </div>
                        </div>

                        <div className="flex gap-3 mt-6">
                            <button
                                onClick={onClose}
                                className="flex-1 px-6 py-3 border border-slate-200 dark:border-slate-700 rounded-xl font-medium hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-700 dark:text-slate-300"
                            >
                                Cancel
                            </button>
                            <button
                                onClick={async () => {
                                    setIsLoading(true);
                                    await onAdd(name, domain);
                                    setIsLoading(false);
                                    setDomain('');
                                    setName('');
                                    onClose();
                                }}
                                disabled={isLoading}
                                className="flex-1 px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700 transition-colors disabled:opacity-50"
                            >
                                {isLoading ? 'Adding...' : 'Add Website'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Live Visitors Component
        const LiveVisitors = ({ visitors }) => (
            <div className="space-y-3">
                {visitors.length === 0 ? (
                    <div className="p-8 text-center text-slate-500">No visitors right now.</div>
                ) : (
                    visitors.map((visitor, i) => (
                        <div
                            key={i}
                            className="flex items-center gap-4 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl animate-slide-up"
                            style={{ animationDelay: `${i * 50}ms` }}
                        >
                            <div className="relative">
                                <div className="w-10 h-10 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white font-bold">
                                    {visitor.country || 'üåç'}
                                </div>
                                <div className="absolute -bottom-1 -right-1 w-4 h-4 bg-emerald-500 rounded-full border-2 border-white dark:border-slate-800 live-dot" />
                            </div>
                            <div className="flex-1 min-w-0">
                                <div className="font-medium text-slate-900 dark:text-white truncate">{visitor.title || visitor.path}</div>
                                <div className="text-sm text-slate-500 flex items-center gap-2">
                                    <span>{visitor.device_type}</span>
                                    <span>‚Ä¢</span>
                                    <span>{visitor.source}</span>
                                </div>
                            </div>
                            <div className="text-right">
                                <div className="font-mono text-sm text-slate-600 dark:text-slate-400">Active</div>
                            </div>
                        </div>
                    ))
                )}
            </div>
        );

        // Main App Component
        const App = () => {
            const [darkMode, setDarkMode] = useState(false);
            const [selectedSite, setSelectedSite] = useState(null);
            const [activeView, setActiveView] = useState('dashboard');
            const [selectedMetric, setSelectedMetric] = useState('visitors');
            const [dateRange, setDateRange] = useState('30d');
            const [showScriptModal, setShowScriptModal] = useState(false);
            const [showAddModal, setShowAddModal] = useState(false);

            // Real Data State
            const [siteList, setSiteList] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [stats, setStats] = useState(null);
            const [timeSeries, setTimeSeries] = useState([]);
            const [topPages, setTopPages] = useState([]);
            const [sources, setSources] = useState([]);
            const [deviceStats, setDeviceStats] = useState({ devices: [], browsers: [] });
            const [liveData, setLiveData] = useState({ count: 0, visitors: [] });
            const [revenueData, setRevenueData] = useState({ stats: [], bySource: [] });

            // Initial Fetch
            useEffect(() => {
                fetchSites();
            }, []);

            // Handle dark mode
            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [darkMode]);

            // Fetch Data when site changes or filtering changes
            useEffect(() => {
                if (!selectedSite) return;

                const fetchData = async () => {
                    setIsLoading(true);
                    try {
                        // Parallel fetching for dashboard
                        const [statsRes, seriesRes] = await Promise.all([
                            fetch(`${API_BASE}/api/sites/${selectedSite}/stats?period=${dateRange}`),
                            fetch(`${API_BASE}/api/sites/${selectedSite}/timeseries?period=${dateRange}`)
                        ]);

                        const statsData = await statsRes.json();
                        const seriesData = await seriesRes.json();

                        setStats(statsData);
                        setTimeSeries(seriesData);
                    } catch (error) {
                        console.error('Failed to fetch data', error);
                    } finally {
                        setIsLoading(false);
                    }
                };

                fetchData();
            }, [selectedSite, dateRange]);

            // Fetch view-specific data
            useEffect(() => {
                if (!selectedSite) return;

                const fetchViewData = async () => {
                    if (activeView === 'pages') {
                        const res = await fetch(`${API_BASE}/api/sites/${selectedSite}/pages?period=${dateRange}`);
                        setTopPages(await res.json());
                    } else if (activeView === 'sources') {
                        const res = await fetch(`${API_BASE}/api/sites/${selectedSite}/sources?period=${dateRange}`);
                        setSources(await res.json());
                    } else if (activeView === 'realtime') {
                        const res = await fetch(`${API_BASE}/api/sites/${selectedSite}/realtime`);
                        setLiveData(await res.json());
                    } else if (activeView === 'revenue') {
                        const res = await fetch(`${API_BASE}/api/sites/${selectedSite}/revenue?period=${dateRange}`);
                        setRevenueData(await res.json());
                    }
                };

                fetchViewData();
            }, [activeView, selectedSite, dateRange]);

            const fetchSites = async () => {
                try {
                    const res = await fetch(`${API_BASE}/api/sites`);
                    const sites = await res.json();
                    setSiteList(sites);
                    if (sites.length > 0 && !selectedSite) {
                        setSelectedSite(sites[0].id);
                    }
                } catch (error) {
                    console.error('Failed to fetch sites', error);
                }
            };

            const handleAddWebsite = async (name, domain) => {
                try {
                    const res = await fetch(`${API_BASE}/api/sites`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, domain })
                    });
                    const newSite = await res.json();

                    // Add color for UI (frontend only)
                    const colors = ['#6366f1', '#8b5cf6', '#a855f7', '#d946ef', '#ec4899', '#f43f5e', '#f97316', '#eab308', '#22c55e', '#14b8a6'];
                    newSite.color = colors[siteList.length % colors.length];

                    setSiteList([newSite, ...siteList]);
                    setSelectedSite(newSite.id);
                    setShowScriptModal(true);
                } catch (error) {
                    alert('Failed to add website');
                }
            };

            const menuItems = [
                { id: 'dashboard', label: 'Dashboard', icon: <Icons.Dashboard /> },
                { id: 'realtime', label: 'Real-time', icon: <Icons.Live /> },
                { id: 'revenue', label: 'ROI / Revenue', icon: <Icons.Dollar /> },
                { id: 'pages', label: 'Pages', icon: <Icons.Eye /> },
                { id: 'sources', label: 'Sources', icon: <Icons.Chart /> },
                { id: 'script', label: 'Get Script', icon: <Icons.Code /> },
                { id: 'settings', label: 'Settings', icon: <Icons.Settings /> },
            ];

            const renderContent = () => {
                if (!selectedSite && !isLoading) {
                    return (
                        <div className="flex flex-col items-center justify-center h-96">
                            <h2 className="text-2xl font-bold mb-4">Welcome to TrackFlow</h2>
                            <p className="mb-6 text-slate-500">Create your first website to get started.</p>
                            <button onClick={() => setShowAddModal(true)} className="px-6 py-3 bg-primary-600 text-white rounded-xl font-medium">
                                Add Website
                            </button>
                        </div>
                    );
                }

                switch (activeView) {
                    case 'realtime':
                        return (
                            <div className="space-y-6">
                                <div className="flex items-center gap-4">
                                    <div className="relative">
                                        <div className="w-4 h-4 bg-emerald-500 rounded-full animate-ping absolute" />
                                        <div className="w-4 h-4 bg-emerald-500 rounded-full relative" />
                                    </div>
                                    <span className="text-4xl font-bold text-slate-900 dark:text-white">{liveData.count}</span>
                                    <span className="text-slate-500">visitors online right now</span>
                                    <button onClick={() => setLiveData({ ...liveData })} className="text-sm text-primary-600">Refresh</button>
                                </div>

                                <div className="glass-card rounded-2xl p-6">
                                    <h3 className="font-semibold text-slate-900 dark:text-white mb-4">Active Visitors</h3>
                                    <LiveVisitors visitors={liveData.visitors} />
                                </div>
                            </div>
                        );

                    case 'revenue':
                        return (
                            <div className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <StatCard
                                        title="Total Revenue"
                                        value={`$${(revenueData.stats[0]?.total_revenue || 0).toLocaleString()}`}
                                        change={0}
                                        icon={<Icons.Dollar />}
                                    />
                                    <StatCard
                                        title="Avg Payment"
                                        value={`$${Math.round(revenueData.stats[0]?.avg_payment || 0)}`}
                                        change={0}
                                        icon={<Icons.TrendUp />}
                                    />
                                    <StatCard
                                        title="Total Sales"
                                        value={(revenueData.stats[0]?.total_payments || 0).toLocaleString()}
                                        change={0}
                                        icon={<Icons.Check />}
                                    />
                                </div>

                                <div className="glass-card rounded-2xl p-6">
                                    <h3 className="font-semibold text-slate-900 dark:text-white mb-6">Revenue by Source (ROI)</h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left">
                                            <thead>
                                                <tr className="border-b border-slate-200 dark:border-slate-700">
                                                    <th className="pb-4 font-medium text-slate-500">Source</th>
                                                    <th className="pb-4 font-medium text-slate-500 text-right">Sales</th>
                                                    <th className="pb-4 font-medium text-slate-500 text-right">Revenue</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100 dark:divide-slate-800">
                                                {revenueData.bySource && revenueData.bySource.length > 0 ? (
                                                    revenueData.bySource.map((row, i) => (
                                                        <tr key={i} className="group hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                                                            <td className="py-4 font-medium text-slate-900 dark:text-white pl-4 rounded-l-xl">{row.source}</td>
                                                            <td className="py-4 text-right text-slate-600 dark:text-slate-400">{row.payments}</td>
                                                            <td className="py-4 text-right font-bold text-emerald-600 rounded-r-xl">${row.revenue.toLocaleString()}</td>
                                                        </tr>
                                                    ))
                                                ) : (
                                                    <tr>
                                                        <td colSpan="3" className="py-8 text-center text-slate-500">No revenue attributed yet.</td>
                                                    </tr>
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        );

                    case 'pages':
                        return (
                            <div className="glass-card rounded-2xl p-6">
                                <h3 className="font-semibold text-slate-900 dark:text-white mb-6">Top Pages</h3>
                                <div className="space-y-4">
                                    {topPages.map((page, i) => (
                                        <div key={page.path} className="animate-slide-up" style={{ animationDelay: `${i * 50}ms` }}>
                                            <div className="flex items-center justify-between mb-2">
                                                <span className="font-mono text-sm text-slate-700 dark:text-slate-300">{page.path} <span className="text-xs text-slate-400">({page.title})</span></span>
                                                <span className="text-sm font-medium text-slate-900 dark:text-white">{page.views.toLocaleString()} views</span>
                                            </div>
                                            <ProgressBar percentage={(page.views / (topPages[0]?.views || 1)) * 100} delay={i * 100} />
                                        </div>
                                    ))}
                                    {topPages.length === 0 && <div className="text-center text-slate-500 py-4">No page views yet.</div>}
                                </div>
                            </div>
                        );

                    case 'sources':
                        return (
                            <div className="glass-card rounded-2xl p-6">
                                <h3 className="font-semibold text-slate-900 dark:text-white mb-6">Traffic Sources</h3>
                                <div className="space-y-4">
                                    {sources.map((source, i) => (
                                        <div key={source.source} className="flex items-center gap-4 animate-slide-up" style={{ animationDelay: `${i * 50}ms` }}>
                                            <div className="flex-1">
                                                <div className="flex justify-between mb-1">
                                                    <span className="font-medium text-slate-900 dark:text-white">{source.source} <span className="text-xs text-slate-400">({source.medium})</span></span>
                                                    <span className="text-sm text-slate-500">{source.visitors.toLocaleString()} visitors</span>
                                                </div>
                                                <ProgressBar percentage={(source.visitors / (sources[0]?.visitors || 1)) * 100} color="#6366f1" />
                                            </div>
                                        </div>
                                    ))}
                                    {sources.length === 0 && <div className="text-center text-slate-500 py-4">No traffic sources yet.</div>}
                                </div>
                            </div>
                        );

                    case 'script':
                        return (
                            <div className="max-w-2xl">
                                <div className="glass-card rounded-2xl p-8">
                                    <h3 className="text-2xl font-bold text-slate-900 dark:text-white mb-2">Install Tracking Script</h3>
                                    <p className="text-slate-600 dark:text-slate-400 mb-6">
                                        Add this lightweight script to your website to start tracking analytics. It's only 4KB and won't slow down your site.
                                    </p>

                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                                Your tracking script
                                            </label>
                                            <pre className="bg-slate-900 text-slate-100 p-6 rounded-xl text-sm overflow-x-auto font-mono">
                                                {`<!-- TrackFlow Analytics -->
<script>
  (function(w,d,s,l,i){
    w[l]=w[l]||[];
    var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s);
    j.async=true;
    j.src='https://trackflow-backend-production.up.railway.app/t.js';
    j.setAttribute('data-site','${selectedSite}');
    f.parentNode.insertBefore(j,f);
  })(window,document,'script','tf','TF-${selectedSite}');
<\/script>`}
                                            </pre>
                                        </div>

                                        <div className="p-4 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl border border-emerald-200 dark:border-emerald-800">
                                            <h4 className="font-semibold text-emerald-800 dark:text-emerald-200 mb-2">‚úÖ Privacy-first tracking</h4>
                                            <p className="text-emerald-700 dark:text-emerald-300 text-sm">
                                                No cookies required. GDPR compliant. We respect user privacy while giving you the insights you need.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );

                    case 'settings':
                        return (
                            <div className="max-w-2xl space-y-6">
                                <div className="glass-card rounded-2xl p-6">
                                    <h3 className="font-semibold text-slate-900 dark:text-white mb-4">Website Settings</h3>
                                    <p className="text-slate-500">Site ID: <span className="font-mono">{selectedSite}</span></p>
                                </div>
                                <div className="glass-card rounded-2xl p-6">
                                    <h3 className="font-semibold text-slate-900 dark:text-white mb-4">Danger Zone</h3>
                                    <button
                                        onClick={async () => {
                                            if (confirm('Are you sure? This cannot be undone.')) {
                                                await fetch(`${API_BASE}/api/sites/${selectedSite}`, { method: 'DELETE' });
                                                window.location.reload();
                                            }
                                        }}
                                        className="px-4 py-2 bg-rose-100 dark:bg-rose-900/30 text-rose-700 dark:text-rose-400 rounded-xl font-medium hover:bg-rose-200 dark:hover:bg-rose-900/50 transition-colors"
                                    >
                                        Delete Website
                                    </button>
                                </div>
                            </div>
                        );

                    default:
                        // Dashboard View
                        return (
                            <>
                                {/* Stats Grid */}
                                <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                                    <StatCard
                                        title="Unique Visitors"
                                        value={stats?.unique_visitors?.toLocaleString() || '0'}
                                        change={stats?.changes?.visitors || 0}
                                        icon={<Icons.Users />}
                                        delay={0}
                                    />
                                    <StatCard
                                        title="Page Views"
                                        value={stats?.total_pageviews?.toLocaleString() || '0'}
                                        change={stats?.changes?.pageviews || 0}
                                        icon={<Icons.Eye />}
                                        delay={100}
                                    />
                                    <StatCard
                                        title="Bounce Rate"
                                        value="-%" // Need endpoint for this
                                        change={0}
                                        icon={<Icons.TrendUp />}
                                        delay={200}
                                    />
                                    <StatCard
                                        title="Active Now"
                                        value={liveData.count}
                                        change={0}
                                        icon={<Icons.Clock />}
                                        delay={300}
                                    />
                                </div>

                                {/* Main Chart */}
                                <div className="glass-card rounded-2xl p-6 mb-8 animate-slide-up" style={{ animationDelay: '400ms' }}>
                                    <div className="flex items-center justify-between mb-6">
                                        <h3 className="font-semibold text-slate-900 dark:text-white">Overview</h3>
                                        <div className="flex p-1 bg-slate-100 dark:bg-slate-800 rounded-xl">
                                            {['visitors', 'pageviews', 'sessions'].map((metric) => (
                                                <button
                                                    key={metric}
                                                    onClick={() => setSelectedMetric(metric)}
                                                    className={`px-4 py-1.5 rounded-lg text-sm font-medium transition-all ${selectedMetric === metric
                                                        ? 'bg-white dark:bg-slate-700 shadow-sm text-slate-900 dark:text-white'
                                                        : 'text-slate-500 hover:text-slate-900 dark:hover:text-white'
                                                        }`}
                                                >
                                                    {metric.charAt(0).toUpperCase() + metric.slice(1)}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="h-80">
                                        <AnalyticsChart data={timeSeries} selectedMetric={selectedMetric} />
                                    </div>
                                </div>
                            </>
                        );
                }
            };

            return (
                <div className="flex h-screen overflow-hidden text-slate-600 dark:text-slate-400">
                    {/* Sidebar */}
                    <aside className="w-64 glass-card border-r border-slate-200 dark:border-slate-800 flex flex-col z-20">
                        <div className="p-6">
                            <div className="flex items-center gap-3 mb-8">
                                <div className="w-8 h-8 bg-gradient-to-tr from-primary-500 to-primary-300 rounded-lg flex items-center justify-center text-white font-bold text-xl">
                                    T
                                </div>
                                <span className="font-bold text-xl text-slate-900 dark:text-white">TrackFlow</span>
                            </div>

                            <div className="mb-8">
                                <WebsiteSelector
                                    websites={siteList}
                                    selectedSite={selectedSite}
                                    onSelect={setSelectedSite}
                                />
                                <button
                                    onClick={() => setShowAddModal(true)}
                                    className="mt-2 w-full py-2 text-sm text-primary-600 font-medium hover:text-primary-700 flex items-center justify-center gap-2"
                                >
                                    <Icons.Plus />
                                    Add Website
                                </button>
                            </div>

                            <nav className="space-y-1">
                                {menuItems.map((item) => (
                                    <button
                                        key={item.id}
                                        onClick={() => setActiveView(item.id)}
                                        className={`sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-colors ${activeView === item.id
                                            ? 'bg-primary-50 dark:bg-primary-900/20 text-primary-600 dark:text-primary-400'
                                            : 'hover:bg-slate-100 dark:hover:bg-slate-800/50'
                                            }`}
                                    >
                                        <div className={activeView === item.id ? 'text-primary-600' : 'text-slate-400'}>
                                            {item.icon}
                                        </div>
                                        {item.label}
                                    </button>
                                ))}
                            </nav>
                        </div>

                        <div className="mt-auto p-6 border-t border-slate-200 dark:border-slate-800">
                            <button
                                onClick={() => setDarkMode(!darkMode)}
                                className="w-full flex items-center justify-between px-4 py-3 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800/50 transition-colors"
                            >
                                <span className="font-medium">Dark Mode</span>
                                <div className={`w-12 h-6 rounded-full p-1 transition-colors ${darkMode ? 'bg-primary-600' : 'bg-slate-300'}`}>
                                    <div className={`w-4 h-4 rounded-full bg-white shadow-sm transition-transform ${darkMode ? 'translate-x-6' : 'translate-x-0'}`} />
                                </div>
                            </button>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 overflow-auto relative">
                        {/* Header */}
                        <header className="sticky top-0 z-10 p-6 flex justify-end">
                            <div className="flex gap-4">
                                {selectedSite && (activeView === 'dashboard' || activeView === 'script') && (
                                    <button
                                        onClick={() => setShowScriptModal(true)}
                                        className="px-6 py-3 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700 transition-colors flex items-center gap-2 animate-pulse-glow"
                                    >
                                        <Icons.Code />
                                        Get Script
                                    </button>
                                )}
                            </div>
                        </header>

                        <div className="p-6 pt-0 max-w-7xl mx-auto">
                            <div className="mb-8">
                                <h2 className="text-2xl font-bold text-slate-900 dark:text-white capitalize">
                                    {menuItems.find(i => i.id === activeView)?.label}
                                </h2>
                                <p className="text-slate-500">
                                    {activeView === 'revenue'
                                        ? 'Track the ROI of your marketing efforts.'
                                        : `Overview of your ${activeView === 'sources' ? 'traffic sources' : activeView}`}
                                </p>

                                {activeView !== 'realtime' && activeView !== 'settings' && activeView !== 'script' && (
                                    <div className="flex items-center gap-2 mt-4 bg-white dark:bg-slate-800 rounded-lg p-1 w-fit border border-slate-200 dark:border-slate-700">
                                        {['7d', '30d', '90d'].map((range) => (
                                            <button
                                                key={range}
                                                onClick={() => setDateRange(range)}
                                                className={`px-3 py-1.5 rounded-md text-sm font-medium transition-all ${dateRange === range
                                                        ? 'bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-white'
                                                        : 'text-slate-500 hover:text-slate-900 dark:hover:text-white'
                                                    }`}
                                            >
                                                Last {range}
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {renderContent()}
                        </div>
                    </main>

                    {/* Modals */}
                    <ScriptModal
                        isOpen={showScriptModal}
                        onClose={() => setShowScriptModal(false)}
                        siteId={selectedSite}
                    />
                    <AddWebsiteModal
                        isOpen={showAddModal}
                        onClose={() => setShowAddModal(false)}
                        onAdd={handleAddWebsite}
                    />
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>

</html>